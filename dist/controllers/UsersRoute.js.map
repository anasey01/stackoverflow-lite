{"version":3,"sources":["../../controllers/UsersRoute.js"],"names":["db","DatabaseManager","userManager","UserManager","UsersRoutes","login","req","res","body","username","password","result","id","status","json","success","message","token","jwt","sign","_id","name","fullname","gender","email","process","env","PRIVATE_KEY","header","signup","registerUser"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,KAAK,IAAIC,yBAAJ,EAAX;AACA,IAAMC,cAAc,IAAIC,qBAAJ,CAAgBH,EAAhB,CAApB;;AAEA,IAAMI,cAAc;AAClBC,OADkB,iBACZC,GADY,EACPC,GADO,EACF;AACdL,gBAAYG,KAAZ,CAAkBC,IAAIE,IAAJ,CAASC,QAA3B,EAAqCH,IAAIE,IAAJ,CAASE,QAA9C,EAAwD,UAACC,MAAD,EAAY;AAClE,UAAI,CAACA,OAAO,CAAP,EAAUC,EAAf,EAAmB;AACjB,eAAOL,IAAIM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC1BC,mBAAS,KADiB;AAE1BC,mBAAS;AAFiB,SAArB,CAAP;AAID;AACD,UAAMC,QAAQC,uBAAIC,IAAJ,CACZ;AACEC,aAAKT,OAAO,CAAP,EAAUC,EADjB;AAEES,cAAMV,OAAO,CAAP,EAAUW,QAFlB;AAGEC,gBAAQZ,OAAO,CAAP,EAAUY,MAHpB;AAIEd,kBAAUE,OAAO,CAAP,EAAUF,QAJtB;AAKEe,eAAOb,OAAO,CAAP,EAAUa;AALnB,OADY,EAOTC,QAAQC,GAAR,CAAYC,WAPH,CAAd;AASA,aAAOpB,IAAIqB,MAAJ,CAAW,cAAX,EAA2BX,KAA3B,EAAkCJ,MAAlC,CAAyC,GAAzC,EAA8CC,IAA9C,CAAmD;AACxDC,iBAAS,IAD+C;AAExDC,iBAAS;AAF+C,OAAnD,CAAP;AAID,KApBD;AAqBD,GAvBiB;AAyBlBa,QAzBkB,kBAyBXvB,GAzBW,EAyBNC,GAzBM,EAyBD;AACf,QAAMe,WAAWhB,IAAIE,IAAJ,CAASc,QAA1B;AACA,QAAMC,SAASjB,IAAIE,IAAJ,CAASe,MAAxB;AACA,QAAMd,WAAWH,IAAIE,IAAJ,CAASC,QAA1B;AACA,QAAMC,WAAWJ,IAAIE,IAAJ,CAASE,QAA1B;AACA,QAAMc,QAAQlB,IAAIE,IAAJ,CAASgB,KAAvB;AACAtB,gBAAY4B,YAAZ,CAAyBR,QAAzB,EAAmCC,MAAnC,EAA2Cd,QAA3C,EAAqDC,QAArD,EAA+Dc,KAA/D,EAAsE,UAACb,MAAD,EAAY;AAChF,UAAIA,WAAW,UAAf,EAA2B;AACzBJ,YAAIM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACnBC,mBAAS,KADU;AAEnBC,mBAAS;AAFU,SAArB;AAID,OALD,MAKO;AACL,YAAMC,QAAQC,uBAAIC,IAAJ,CAAS;AACrBG,oBAAUX,OAAOW,QADI;AAErBC,kBAAQZ,OAAOY,MAFM;AAGrBd,oBAAUE,OAAOF,QAHI;AAIrBe,iBAAOb,OAAOa;AAJO,SAAT,EAKXC,QAAQC,GAAR,CAAYC,WALD,CAAd;AAMApB,YAAIqB,MAAJ,CAAW,cAAX,EAA2BX,KAA3B,EAAkCJ,MAAlC,CAAyC,GAAzC,EAA8CC,IAA9C,CAAmD;AACjDC,mBAAS,IADwC;AAEjDC,mBAAS;AAFwC,SAAnD;AAID;AACF,KAlBD;AAmBD;AAlDiB,CAApB;;kBAqDeZ,W","file":"UsersRoute.js","sourcesContent":["import jwt from 'jsonwebtoken';\r\nimport UserManager from './UserManager';\r\nimport DatabaseManager from '../net/DatabaseManager';\r\n\r\nconst db = new DatabaseManager();\r\nconst userManager = new UserManager(db);\r\n\r\nconst UsersRoutes = {\r\n  login(req, res) {\r\n    userManager.login(req.body.username, req.body.password, (result) => {\r\n      if (!result[0].id) {\r\n        return res.status(401).json({\r\n          success: false,\r\n          message: 'username or password incorrect',\r\n        });\r\n      }\r\n      const token = jwt.sign(\r\n        {\r\n          _id: result[0].id,\r\n          name: result[0].fullname,\r\n          gender: result[0].gender,\r\n          username: result[0].username,\r\n          email: result[0].email,\r\n        }, process.env.PRIVATE_KEY,\r\n      );\r\n      return res.header('x-auth-token', token).status(200).json({\r\n        success: true,\r\n        message: 'Successfully logged in',\r\n      });\r\n    });\r\n  },\r\n\r\n  signup(req, res) {\r\n    const fullname = req.body.fullname;\r\n    const gender = req.body.gender;\r\n    const username = req.body.username;\r\n    const password = req.body.password;\r\n    const email = req.body.email;\r\n    userManager.registerUser(fullname, gender, username, password, email, (result) => {\r\n      if (result === 'existing') {\r\n        res.status(401).json({\r\n          success: false,\r\n          message: 'username already exists',\r\n        });\r\n      } else {\r\n        const token = jwt.sign({\r\n          fullname: result.fullname,\r\n          gender: result.gender,\r\n          username: result.username,\r\n          email: result.email,\r\n        }, process.env.PRIVATE_KEY);\r\n        res.header('x-auth-token', token).status(200).json({\r\n          success: true,\r\n          message: 'user succesfully registered',\r\n        });\r\n      }\r\n    });\r\n  },\r\n};\r\n\r\nexport default UsersRoutes;\r\n"]}