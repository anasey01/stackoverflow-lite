{"version":3,"sources":["../../controllers/UsersRoute.js"],"names":["db","DatabaseManager","userManager","UserManager","UsersRoutes","login","req","res","body","username","password","result","userid","status","json","success","message","token","jwt","sign","userId","process","env","PRIVATE_KEY","header","signup","fullname","gender","email","registerUser"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,KAAK,IAAIC,yBAAJ,EAAX;AACA,IAAMC,cAAc,IAAIC,qBAAJ,CAAgBH,EAAhB,CAApB;;AAEA,IAAMI,cAAc;AAClBC,OADkB,iBACZC,GADY,EACPC,GADO,EACF;AACdL,gBAAYG,KAAZ,CAAkBC,IAAIE,IAAJ,CAASC,QAA3B,EAAqCH,IAAIE,IAAJ,CAASE,QAA9C,EAAwD,UAACC,MAAD,EAAY;AAClE,UAAI,CAACA,OAAO,CAAP,EAAUC,MAAf,EAAuB;AACrB,eAAOL,IAAIM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC1BC,mBAAS,KADiB;AAE1BC,mBAAS;AAFiB,SAArB,CAAP;AAID;AACD,UAAMC,QAAQC,uBAAIC,IAAJ,CACZ;AACEC,gBAAQT,OAAO,CAAP,EAAUC,MADpB;AAEEH,kBAAUE,OAAO,CAAP,EAAUF;AAFtB,OADY,EAITY,QAAQC,GAAR,CAAYC,WAJH,CAAd;AAMA,aAAOhB,IAAIiB,MAAJ,CAAW,cAAX,EAA2BP,KAA3B,EAAkCJ,MAAlC,CAAyC,GAAzC,EAA8CC,IAA9C,CAAmD;AACxDC,iBAAS,IAD+C;AAExDC,iBAAS,wBAF+C;AAGxDC;AAHwD,OAAnD,CAAP;AAKD,KAlBD;AAmBD,GArBiB;AAuBlBQ,QAvBkB,kBAuBXnB,GAvBW,EAuBNC,GAvBM,EAuBD;AAAA,oBAGXD,IAAIE,IAHO;AAAA,QAEbkB,QAFa,aAEbA,QAFa;AAAA,QAEHC,MAFG,aAEHA,MAFG;AAAA,QAEKlB,QAFL,aAEKA,QAFL;AAAA,QAEeC,QAFf,aAEeA,QAFf;AAAA,QAEyBkB,KAFzB,aAEyBA,KAFzB;;AAIf1B,gBAAY2B,YAAZ,CAAyBH,QAAzB,EAAmCC,MAAnC,EAA2ClB,QAA3C,EAAqDC,QAArD,EAA+DkB,KAA/D,EAAsE,UAACjB,MAAD,EAAY;AAChF,UAAIA,WAAW,UAAf,EAA2B;AACzBJ,YAAIM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACnBC,mBAAS,KADU;AAEnBC,mBAAS;AAFU,SAArB;AAID,OALD,MAKO;AACL,YAAMC,QAAQC,uBAAIC,IAAJ,CAAS;AACrBV,oBAAUE,OAAOF,QADI;AAErBmB,iBAAOjB,OAAOiB;AAFO,SAAT,EAGXP,QAAQC,GAAR,CAAYC,WAHD,CAAd;AAIAhB,YAAIiB,MAAJ,CAAW,cAAX,EAA2BP,KAA3B,EAAkCJ,MAAlC,CAAyC,GAAzC,EAA8CC,IAA9C,CAAmD;AACjDC,mBAAS,IADwC;AAEjDC,mBAAS;AAFwC,SAAnD;AAID;AACF,KAhBD;AAiBD;AA5CiB,CAApB;;kBA+CeZ,W","file":"UsersRoute.js","sourcesContent":["import jwt from 'jsonwebtoken';\r\nimport UserManager from './UserManager';\r\nimport DatabaseManager from '../net/DatabaseManager';\r\n\r\nconst db = new DatabaseManager();\r\nconst userManager = new UserManager(db);\r\n\r\nconst UsersRoutes = {\r\n  login(req, res) {\r\n    userManager.login(req.body.username, req.body.password, (result) => {\r\n      if (!result[0].userid) {\r\n        return res.status(401).json({\r\n          success: false,\r\n          message: 'username or password incorrect',\r\n        });\r\n      }\r\n      const token = jwt.sign(\r\n        {\r\n          userId: result[0].userid,\r\n          username: result[0].username,\r\n        }, process.env.PRIVATE_KEY,\r\n      );\r\n      return res.header('x-auth-token', token).status(200).json({\r\n        success: true,\r\n        message: 'Successfully logged in',\r\n        token,\r\n      });\r\n    });\r\n  },\r\n\r\n  signup(req, res) {\r\n    const {\r\n      fullname, gender, username, password, email,\r\n    } = req.body;\r\n    userManager.registerUser(fullname, gender, username, password, email, (result) => {\r\n      if (result === 'existing') {\r\n        res.status(401).json({\r\n          success: false,\r\n          message: 'username already exists',\r\n        });\r\n      } else {\r\n        const token = jwt.sign({\r\n          username: result.username,\r\n          email: result.email,\r\n        }, process.env.PRIVATE_KEY);\r\n        res.header('x-auth-token', token).status(200).json({\r\n          success: true,\r\n          message: 'user succesfully registered',\r\n        });\r\n      }\r\n    });\r\n  },\r\n};\r\n\r\nexport default UsersRoutes;\r\n"]}