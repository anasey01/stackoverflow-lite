{"version":3,"sources":["../../controllers/UsersRoute.js"],"names":["db","DatabaseManager","userManager","UserManager","UsersRoutes","login","req","res","body","username","password","result","userid","status","json","success","message","token","jwt","sign","userId","process","env","PRIVATE_KEY","header","signup","fullname","gender","email","registerUser"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,KAAK,IAAIC,yBAAJ,EAAX;AACA,IAAMC,cAAc,IAAIC,qBAAJ,CAAgBH,EAAhB,CAApB;;AAEA,IAAMI,cAAc;AAClBC,OADkB,iBACZC,GADY,EACPC,GADO,EACF;AAAA,oBACiBD,IAAIE,IADrB;AAAA,QACNC,QADM,aACNA,QADM;AAAA,QACIC,QADJ,aACIA,QADJ;;AAEdR,gBAAYG,KAAZ,CAAkBI,QAAlB,EAA4BC,QAA5B,EAAsC,UAACC,MAAD,EAAY;AAChD,UAAI,CAACA,OAAO,CAAP,EAAUC,MAAf,EAAuB;AACrB,eAAOL,IAAIM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC1BC,mBAAS,KADiB;AAE1BC,mBAAS;AAFiB,SAArB,CAAP;AAID;AACD,UAAMC,QAAQC,uBAAIC,IAAJ,CACZ;AACEC,gBAAQT,OAAO,CAAP,EAAUC,MADpB;AAEEH,kBAAUE,OAAO,CAAP,EAAUF;AAFtB,OADY,EAITY,QAAQC,GAAR,CAAYC,WAJH,CAAd;AAMA,aAAOhB,IAAIiB,MAAJ,CAAW,cAAX,EAA2BP,KAA3B,EAAkCJ,MAAlC,CAAyC,GAAzC,EAA8CC,IAA9C,CAAmD;AACxDC,iBAAS,IAD+C;AAExDC,iBAAS,wBAF+C;AAGxDC;AAHwD,OAAnD,CAAP;AAKD,KAlBD;AAmBD,GAtBiB;AAwBlBQ,QAxBkB,kBAwBXnB,GAxBW,EAwBNC,GAxBM,EAwBD;AAAA,qBAGXD,IAAIE,IAHO;AAAA,QAEbkB,QAFa,cAEbA,QAFa;AAAA,QAEHC,MAFG,cAEHA,MAFG;AAAA,QAEKlB,QAFL,cAEKA,QAFL;AAAA,QAEeC,QAFf,cAEeA,QAFf;AAAA,QAEyBkB,KAFzB,cAEyBA,KAFzB;;AAIf1B,gBAAY2B,YAAZ,CAAyBH,QAAzB,EAAmCC,MAAnC,EAA2ClB,QAA3C,EAAqDC,QAArD,EAA+DkB,KAA/D,EAAsE,UAACjB,MAAD,EAAY;AAChF,UAAIA,WAAW,UAAf,EAA2B;AACzB,eAAOJ,IAAIM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC1BC,mBAAS,KADiB;AAE1BC,mBAAS;AAFiB,SAArB,CAAP;AAID;AACD,UAAMC,QAAQC,uBAAIC,IAAJ,CAAS;AACrBV,kBAAUE,OAAOF,QADI;AAErBmB,eAAOjB,OAAOiB;AAFO,OAAT,EAGXP,QAAQC,GAAR,CAAYC,WAHD,CAAd;AAIA,aAAOhB,IAAIiB,MAAJ,CAAW,cAAX,EAA2BP,KAA3B,EAAkCJ,MAAlC,CAAyC,GAAzC,EAA8CC,IAA9C,CAAmD;AACxDC,iBAAS,IAD+C;AAExDC,iBAAS;AAF+C,OAAnD,CAAP;AAID,KAfD;AAgBD;AA5CiB,CAApB;;kBA+CeZ,W","file":"UsersRoute.js","sourcesContent":["import jwt from 'jsonwebtoken';\nimport UserManager from './UserManager';\nimport DatabaseManager from '../net/DatabaseManager';\n\nconst db = new DatabaseManager();\nconst userManager = new UserManager(db);\n\nconst UsersRoutes = {\n  login(req, res) {\n    const { username, password } = req.body;\n    userManager.login(username, password, (result) => {\n      if (!result[0].userid) {\n        return res.status(401).json({\n          success: false,\n          message: 'username or password incorrect',\n        });\n      }\n      const token = jwt.sign(\n        {\n          userId: result[0].userid,\n          username: result[0].username,\n        }, process.env.PRIVATE_KEY,\n      );\n      return res.header('x-auth-token', token).status(200).json({\n        success: true,\n        message: 'Successfully logged in',\n        token,\n      });\n    });\n  },\n\n  signup(req, res) {\n    const {\n      fullname, gender, username, password, email,\n    } = req.body;\n    userManager.registerUser(fullname, gender, username, password, email, (result) => {\n      if (result === 'existing') {\n        return res.status(401).json({\n          success: false,\n          message: 'username or email exists',\n        });\n      }\n      const token = jwt.sign({\n        username: result.username,\n        email: result.email,\n      }, process.env.PRIVATE_KEY);\n      return res.header('x-auth-token', token).status(200).json({\n        success: true,\n        message: 'user succesfully registered',\n      });\n    });\n  },\n};\n\nexport default UsersRoutes;\n"]}