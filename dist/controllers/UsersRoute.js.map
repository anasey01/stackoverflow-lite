{"version":3,"sources":["../../controllers/UsersRoute.js"],"names":["db","DatabaseManager","userManager","UserManager","UsersRoutes","req","res","body","username","password","login","result","userid","status","json","success","message","token","jwt","sign","userId","process","env","PRIVATE_KEY","expiresIn","header","fullname","gender","email","registerUser"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;AACA;;;;;;;;AAEA,IAAMA,KAAK,IAAIC,yBAAJ,EAAX;AACA,IAAMC,cAAc,IAAIC,qBAAJ,CAAgBH,EAAhB,CAApB;;IAEMI,W;;;;;;;0BACSC,G,EAAKC,G,EAAK;AAAA,sBACUD,IAAIE,IADd;AAAA,UACbC,QADa,aACbA,QADa;AAAA,UACHC,QADG,aACHA,QADG;;AAErBP,kBAAYQ,KAAZ,CAAkBF,QAAlB,EAA4BC,QAA5B,EAAsC,UAACE,MAAD,EAAY;AAChD,YAAI,CAACA,OAAO,CAAP,EAAUC,MAAf,EAAuB;AACrB,iBAAON,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC1BC,qBAAS,KADiB;AAE1BC,qBAAS;AAFiB,WAArB,CAAP;AAID;AACD,YAAMC,QAAQC,uBAAIC,IAAJ,CACZ;AACEC,kBAAQT,OAAO,CAAP,EAAUC,MADpB;AAEEJ,oBAAUG,OAAO,CAAP,EAAUH;AAFtB,SADY,EAITa,QAAQC,GAAR,CAAYC,WAJH,EAKZ,EAAEC,WAAW,IAAb,EALY,CAAd;AAOA,eAAOlB,IAAImB,MAAJ,CAAW,cAAX,EAA2BR,KAA3B,EAAkCJ,MAAlC,CAAyC,GAAzC,EAA8CC,IAA9C,CAAmD;AACxDC,mBAAS,IAD+C;AAExDC,mBAAS,wBAF+C;AAGxDR,oBAAUG,OAAO,CAAP,EAAUH,QAHoC;AAIxDS;AAJwD,SAAnD,CAAP;AAMD,OApBD;AAqBD;;;2BAEaZ,G,EAAKC,G,EAAK;AAAA,uBAGlBD,IAAIE,IAHc;AAAA,UAEpBmB,QAFoB,cAEpBA,QAFoB;AAAA,UAEVC,MAFU,cAEVA,MAFU;AAAA,UAEFnB,QAFE,cAEFA,QAFE;AAAA,UAEQC,QAFR,cAEQA,QAFR;AAAA,UAEkBmB,KAFlB,cAEkBA,KAFlB;;AAItB1B,kBAAY2B,YAAZ,CAAyBH,QAAzB,EAAmCC,MAAnC,EAA2CnB,QAA3C,EAAqDC,QAArD,EAA+DmB,KAA/D,EAAsE,UAACjB,MAAD,EAAY;AAChF,YAAIA,WAAW,UAAf,EAA2B;AACzB,iBAAOL,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC1BC,qBAAS,KADiB;AAE1BC,qBAAS;AAFiB,WAArB,CAAP;AAID;AACD,YAAMC,QAAQC,uBAAIC,IAAJ,CAAS;AACrBX,oBAAUG,OAAOH,QADI;AAErBoB,iBAAOjB,OAAOiB;AAFO,SAAT,EAGXP,QAAQC,GAAR,CAAYC,WAHD,CAAd;AAIA,eAAOjB,IAAImB,MAAJ,CAAW,cAAX,EAA2BR,KAA3B,EAAkCJ,MAAlC,CAAyC,GAAzC,EAA8CC,IAA9C,CAAmD;AACxDC,mBAAS,IAD+C;AAExDC,mBAAS;AAF+C,SAAnD,CAAP;AAID,OAfD;AAgBD;;;;;;kBAGYZ,W","file":"UsersRoute.js","sourcesContent":["import jwt from 'jsonwebtoken';\nimport UserManager from './UserManager';\nimport DatabaseManager from '../net/DatabaseManager';\n\nconst db = new DatabaseManager();\nconst userManager = new UserManager(db);\n\nclass UsersRoutes {\n  static login(req, res) {\n    const { username, password } = req.body;\n    userManager.login(username, password, (result) => {\n      if (!result[0].userid) {\n        return res.status(401).json({\n          success: false,\n          message: 'username or password incorrect',\n        });\n      }\n      const token = jwt.sign(\n        {\n          userId: result[0].userid,\n          username: result[0].username,\n        }, process.env.PRIVATE_KEY,\n        { expiresIn: '5h' },\n      );\n      return res.header('x-auth-token', token).status(200).json({\n        success: true,\n        message: 'Successfully logged in',\n        username: result[0].username,\n        token,\n      });\n    });\n  }\n\n  static signup(req, res) {\n    const {\n      fullname, gender, username, password, email,\n    } = req.body;\n    userManager.registerUser(fullname, gender, username, password, email, (result) => {\n      if (result === 'existing') {\n        return res.status(401).json({\n          success: false,\n          message: 'username or email exists',\n        });\n      }\n      const token = jwt.sign({\n        username: result.username,\n        email: result.email,\n      }, process.env.PRIVATE_KEY);\n      return res.header('x-auth-token', token).status(200).json({\n        success: true,\n        message: 'user succesfully registered',\n      });\n    });\n  }\n}\n\nexport default UsersRoutes;\n"]}