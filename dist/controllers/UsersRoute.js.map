{"version":3,"sources":["../../controllers/UsersRoute.js"],"names":["db","DatabaseManager","userManager","UserManager","UsersRoutes","login","req","res","body","username","password","result","id","status","json","success","message","token","jwt","sign","_id","name","fullname","gender","email","process","env","PRIVATE_KEY","header","signup","registerUser"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,KAAK,IAAIC,yBAAJ,EAAX;AACA,IAAMC,cAAc,IAAIC,qBAAJ,CAAgBH,EAAhB,CAApB;;AAEA,IAAMI,cAAc;AAClBC,OADkB,iBACZC,GADY,EACPC,GADO,EACF;AACdL,gBAAYG,KAAZ,CAAkBC,IAAIE,IAAJ,CAASC,QAA3B,EAAqCH,IAAIE,IAAJ,CAASE,QAA9C,EAAwD,UAACC,MAAD,EAAY;AAClE,UAAI,CAACA,OAAO,CAAP,EAAUC,EAAf,EAAmB;AACjB,eAAOL,IAAIM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC1BC,mBAAS,KADiB;AAE1BC,mBAAS;AAFiB,SAArB,CAAP;AAID;AACD,UAAMC,QAAQC,uBAAIC,IAAJ,CACZ;AACEC,aAAKT,OAAO,CAAP,EAAUC,EADjB;AAEES,cAAMV,OAAO,CAAP,EAAUW,QAFlB;AAGEC,gBAAQZ,OAAO,CAAP,EAAUY,MAHpB;AAIEd,kBAAUE,OAAO,CAAP,EAAUF,QAJtB;AAKEe,eAAOb,OAAO,CAAP,EAAUa;AALnB,OADY,EAOTC,QAAQC,GAAR,CAAYC,WAPH,CAAd;AASA,aAAOpB,IAAIqB,MAAJ,CAAW,cAAX,EAA2BX,KAA3B,EAAkCJ,MAAlC,CAAyC,GAAzC,EAA8CC,IAA9C,CAAmD;AACxDC,iBAAS,IAD+C;AAExDC,iBAAS;AAF+C,OAAnD,CAAP;AAID,KApBD;AAqBD,GAvBiB;AAyBlBa,QAzBkB,kBAyBXvB,GAzBW,EAyBNC,GAzBM,EAyBD;AAAA,oBAGXD,IAAIE,IAHO;AAAA,QAEbc,QAFa,aAEbA,QAFa;AAAA,QAEHC,MAFG,aAEHA,MAFG;AAAA,QAEKd,QAFL,aAEKA,QAFL;AAAA,QAEeC,QAFf,aAEeA,QAFf;AAAA,QAEyBc,KAFzB,aAEyBA,KAFzB;;AAIftB,gBAAY4B,YAAZ,CAAyBR,QAAzB,EAAmCC,MAAnC,EAA2Cd,QAA3C,EAAqDC,QAArD,EAA+Dc,KAA/D,EAAsE,UAACb,MAAD,EAAY;AAChF,UAAIA,WAAW,UAAf,EAA2B;AACzBJ,YAAIM,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACnBC,mBAAS,KADU;AAEnBC,mBAAS;AAFU,SAArB;AAID,OALD,MAKO;AACL,YAAMC,QAAQC,uBAAIC,IAAJ,CAAS;AACrBG,oBAAUX,OAAOW,QADI;AAErBC,kBAAQZ,OAAOY,MAFM;AAGrBd,oBAAUE,OAAOF,QAHI;AAIrBe,iBAAOb,OAAOa;AAJO,SAAT,EAKXC,QAAQC,GAAR,CAAYC,WALD,CAAd;AAMApB,YAAIqB,MAAJ,CAAW,cAAX,EAA2BX,KAA3B,EAAkCJ,MAAlC,CAAyC,GAAzC,EAA8CC,IAA9C,CAAmD;AACjDC,mBAAS,IADwC;AAEjDC,mBAAS;AAFwC,SAAnD;AAID;AACF,KAlBD;AAmBD;AAhDiB,CAApB;;kBAmDeZ,W","file":"UsersRoute.js","sourcesContent":["import jwt from 'jsonwebtoken';\nimport UserManager from './UserManager';\nimport DatabaseManager from '../net/DatabaseManager';\n\nconst db = new DatabaseManager();\nconst userManager = new UserManager(db);\n\nconst UsersRoutes = {\n  login(req, res) {\n    userManager.login(req.body.username, req.body.password, (result) => {\n      if (!result[0].id) {\n        return res.status(401).json({\n          success: false,\n          message: 'username or password incorrect',\n        });\n      }\n      const token = jwt.sign(\n        {\n          _id: result[0].id,\n          name: result[0].fullname,\n          gender: result[0].gender,\n          username: result[0].username,\n          email: result[0].email,\n        }, process.env.PRIVATE_KEY,\n      );\n      return res.header('x-auth-token', token).status(200).json({\n        success: true,\n        message: 'Successfully logged in',\n      });\n    });\n  },\n\n  signup(req, res) {\n    const {\n      fullname, gender, username, password, email,\n    } = req.body;\n    userManager.registerUser(fullname, gender, username, password, email, (result) => {\n      if (result === 'existing') {\n        res.status(401).json({\n          success: false,\n          message: 'username already exists',\n        });\n      } else {\n        const token = jwt.sign({\n          fullname: result.fullname,\n          gender: result.gender,\n          username: result.username,\n          email: result.email,\n        }, process.env.PRIVATE_KEY);\n        res.header('x-auth-token', token).status(200).json({\n          success: true,\n          message: 'user succesfully registered',\n        });\n      }\n    });\n  },\n};\n\nexport default UsersRoutes;\n"]}