{"version":3,"sources":["../../controllers/QuestionRoutes.js"],"names":["db","DatabaseManager","questionManager","QuestionManager","QuestionRoute","req","res","getAllQuestion","data","err","status","json","success","message","questions","questionId","params","id","questionData","getQuestion","result","questionid","userId","userid","questionTitle","questiontitle","questionContent","questioncontent","createdAt","createdat","answers","getAnswer","answer","rows","length","forEach","item","push","singleAnswer","body","user","createQuestion","Number","getQuestionAndAnswer","answerNumber","createAnswer","error","answerInfo","getUserQuestions","userQuestions","deleteOne","isDeleted","rowCount","currentUserId","answerData","isAnswer","answernumber","markAnswer","updateAnswer"],"mappings":"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","file":"QuestionRoutes.js","sourcesContent":["import DatabaseManager from '../net/DatabaseManager';\nimport QuestionManager from './QuestionManager';\n\nconst db = new DatabaseManager();\nconst questionManager = new QuestionManager(db);\n\nclass QuestionRoute {\n  static allQuestion(req, res) {\n    questionManager.getAllQuestion((data, err) => {\n      if (err) {\n        return res.status(500).json({\n          success: false,\n          message: 'No question found',\n        });\n      }\n      return res.status(200).json({ questions: data });\n    });\n  }\n\n  static specificQuestion(req, res) {\n    const questionId = req.params.id;\n    const questionData = {};\n    questionManager.getQuestion(questionId, (result) => {\n      questionData.success = true;\n      questionData.message = 'Questions retrieved';\n      questionData.questionId = result.questionid;\n      questionData.userId = result.userid;\n      questionData.questionTitle = result.questiontitle;\n      questionData.questionContent = result.questioncontent;\n      questionData.createdAt = result.createdat;\n      questionData.answers = [];\n      questionManager.getAnswer(questionId, (answer) => {\n        if (answer.rows.length > 1) {\n          answer.rows.forEach((item) => {\n            questionData.answers.push({ item });\n          });\n          res.status(200).json(questionData);\n        }\n        if (answer.rows.length === 1) {\n          const singleAnswer = answer.rows;\n          questionData.answers.push({ singleAnswer });\n          res.status(200).json(questionData);\n        }\n      });\n      res.status(200).json(questionData);\n    });\n  }\n\n  static postQuestion(req, res) {\n    const { questionTitle, questionContent } = req.body;\n    const { userId } = req.user;\n    questionManager.createQuestion(userId, questionTitle, questionContent, (err, result) => {\n      if (err) {\n        return res.status(400).json({\n          success: false,\n          message: 'unable to create question',\n        });\n      }\n      return res.status(200).json({\n        success: true,\n        message: 'question successfully created',\n        userId: result[0].userid,\n        questionId: result[0].questionid,\n        questionTitle: result[0].questiontitle,\n        questionContent: result[0].questioncontent,\n        createdAt: result[0].createdat,\n      });\n    });\n  }\n\n  static addAnswer(req, res) {\n    const questionId = Number(req.params.id);\n    const { userId } = req.user;\n    const { answer } = req.body;\n    questionManager.getQuestionAndAnswer(questionId, (err, result) => {\n      const answerNumber = result.length + 1;\n      questionManager.createAnswer(userId, questionId, answer, answerNumber, (error, data) => {\n        if (error) {\n          res.status(500).json({\n            success: false,\n            message: 'Unable to add answer',\n          });\n        }\n        const answerInfo = data.rows[0];\n        res.status(200).json({\n          success: true,\n          message: 'Your answer has been successfully added',\n          answerInfo,\n        });\n      });\n    });\n  }\n\n  static getAllQuestionsByUser(req, res) {\n    const { userId } = req.user;\n    questionManager.getUserQuestions(userId, (error, result) => {\n      const userQuestions = result;\n      if (error) {\n        res.status(500).json({\n          success: false,\n          message: 'unable to retrieve questions',\n        });\n      } else {\n        res.status(200).json({\n          success: true,\n          message: 'All Questions by User',\n          userQuestions,\n        });\n      }\n    });\n  }\n\n  static deleteQuestion(req, res) {\n    const { id } = req.params;\n    questionManager.deleteOne(id, (result, err) => {\n      let isDeleted = '';\n      if (result.rowCount === 1) {\n        isDeleted = 'deleted';\n      }\n      if (isDeleted === 'deleted') {\n        return res.status(200).json({\n          success: true,\n          message: 'Question deleted!',\n        });\n      }\n      if (isDeleted === '') {\n        return res.status(401).json({\n          success: false,\n          message: 'Unable to delete question',\n        });\n      }\n    });\n  }\n\n\n  static updateAnswer(req, res) {\n    const { questionId, answerNumber } = req.params;\n    const currentUserId = req.user.userId;\n    const { answer } = req.body;\n    questionManager.getQuestionAndAnswer(questionId, (err, result) => {\n      const answerData = [];\n      let isAnswer = 'not found';\n      result.forEach((item) => {\n        if (item.answernumber === Number(answerNumber)) {\n          isAnswer = 'found';\n          return answerData.push(item);\n        }\n      });\n      if (isAnswer === 'found') {\n        if (currentUserId === Number(questionId)) {\n          questionManager.markAnswer(answerNumber, (result) => {\n            if (result === 'successfully marked') {\n              res.status(200).json({\n                success: true,\n                message: 'Answer marked as approved!',\n              });\n            } else {\n              res.status(500).json({\n                success: false,\n                message: 'unable to mark answer',\n              });\n            }\n          });\n        } else if (currentUserId === answerData[0].userid) {\n          questionManager.updateAnswer(answerNumber, answer, (error, answerInfo) => {\n            if (error) {\n              res.status(500).json({\n                success: false,\n                message: 'Unable to update Answer',\n              });\n            } else {\n              res.status(200).json({\n                success: true,\n                message: 'Your answer has been updated',\n                answerInfo,\n              });\n            }\n          });\n        }\n      } else {\n        res.status(404).json({\n          success: false,\n          message: isAnswer,\n        });\n      }\n    });\n  }\n\n  static notFound(req, res) {\n    res.status(404).json({\n      status: false,\n      message: 'Not Found!',\n    });\n  }\n}\n\nexport default QuestionRoute;\n"]}