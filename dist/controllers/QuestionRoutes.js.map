{"version":3,"sources":["../../controllers/QuestionRoutes.js"],"names":["db","DatabaseManager","questionManager","QuestionManager","QuestionRoute","req","res","getAllQuestion","data","err","status","json","success","message","questions","questionId","params","id","questionData","getQuestion","result","questionid","userId","userid","questionTitle","questiontitle","questionContent","questioncontent","createdAt","createdat","answers","getAnswer","answer","rows","length","forEach","item","push","singleAnswer","body","user","username","createQuestion","Number","getQuestionAndAnswer","answerNumber","createAnswer","error","answerInfo","getUserQuestions","userQuestions","deleteOne","isDeleted","rowCount","currentUserId","answerData","isAnswer","answernumber","markAnswer","updateAnswer"],"mappings":"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","file":"QuestionRoutes.js","sourcesContent":["import DatabaseManager from '../net/DatabaseManager';\r\nimport QuestionManager from './QuestionManager';\r\n\r\nconst db = new DatabaseManager();\r\nconst questionManager = new QuestionManager(db);\r\n\r\nclass QuestionRoute {\r\n  static allQuestion(req, res) {\r\n    questionManager.getAllQuestion((data, err) => {\r\n      if (err) {\r\n        return res.status(500).json({\r\n          success: false,\r\n          message: 'No question found',\r\n        });\r\n      }\r\n      return res.status(200).json({\r\n        success: true,\r\n        message: 'All Questions Retrieved',\r\n        questions: data,\r\n      });\r\n    });\r\n  }\r\n\r\n  static specificQuestion(req, res) {\r\n    const questionId = req.params.id;\r\n    const questionData = {};\r\n    questionManager.getQuestion(questionId, (result) => {\r\n      questionData.success = true;\r\n      questionData.message = 'Questions retrieved';\r\n      questionData.questionId = result.questionid;\r\n      questionData.userId = result.userid;\r\n      questionData.questionTitle = result.questiontitle;\r\n      questionData.questionContent = result.questioncontent;\r\n      questionData.createdAt = result.createdat;\r\n      questionData.answers = [];\r\n      questionManager.getAnswer(questionId, (answer) => {\r\n        if (answer.rows.length > 1) {\r\n          answer.rows.forEach((item) => {\r\n            questionData.answers.push({ item });\r\n          });\r\n          return res.status(200).json(questionData);\r\n        }\r\n        if (answer.rows.length === 1) {\r\n          const singleAnswer = answer.rows;\r\n          questionData.answers.push({ singleAnswer });\r\n          res.status(200).json(questionData);\r\n        }\r\n      });\r\n      return res.status(200).json(questionData);\r\n    });\r\n  }\r\n\r\n  static postQuestion(req, res) {\r\n    const { questionTitle, questionContent } = req.body;\r\n    const { userId, username } = req.user;\r\n    questionManager.createQuestion(userId, questionTitle, questionContent, username, (err, result) => {\r\n      if (err) {\r\n        return res.status(400).json({\r\n          success: false,\r\n          message: 'unable to create question',\r\n        });\r\n      }\r\n      return res.status(200).json({\r\n        success: true,\r\n        message: 'question successfully created',\r\n        username: result[0].username,\r\n        userId: result[0].userid,\r\n        questionId: result[0].questionid,\r\n        questionTitle: result[0].questiontitle,\r\n        questionContent: result[0].questioncontent,\r\n        createdAt: result[0].createdat,\r\n      });\r\n    });\r\n  }\r\n\r\n  static addAnswer(req, res) {\r\n    const questionId = Number(req.params.id);\r\n    const { userId, username } = req.user;\r\n    const { answer } = req.body;\r\n    questionManager.getQuestionAndAnswer(questionId, (err, result) => {\r\n      const answerNumber = result.length + 1;\r\n      questionManager.createAnswer(userId, questionId, answer, answerNumber, username, (error, data) => {\r\n        if (error) {\r\n          return res.status(500).json({\r\n            success: false,\r\n            message: 'Unable to add answer',\r\n          });\r\n        }\r\n        const answerInfo = data.rows[0];\r\n        return res.status(200).json({\r\n          success: true,\r\n          message: 'Your answer has been successfully added',\r\n          answerInfo,\r\n        });\r\n      });\r\n    });\r\n  }\r\n\r\n  static getAllQuestionsByUser(req, res) {\r\n    const { userId } = req.user;\r\n    questionManager.getUserQuestions(userId, (error, result) => {\r\n      const userQuestions = result;\r\n      if (error) {\r\n        return res.status(500).json({\r\n          success: false,\r\n          message: 'unable to retrieve questions',\r\n        });\r\n      }\r\n      return res.status(200).json({\r\n        success: true,\r\n        message: 'All Questions by User',\r\n        userQuestions,\r\n      });\r\n    });\r\n  }\r\n\r\n  static deleteQuestion(req, res) {\r\n    const { id } = req.params;\r\n    questionManager.deleteOne(id, (result, err) => {\r\n      let isDeleted = '';\r\n      if (result.rowCount === 1) {\r\n        isDeleted = 'deleted';\r\n      }\r\n      if (isDeleted === 'deleted') {\r\n        return res.status(200).json({\r\n          success: true,\r\n          message: 'Question deleted!',\r\n        });\r\n      }\r\n      if (isDeleted === '') {\r\n        return res.status(401).json({\r\n          success: false,\r\n          message: 'Unable to delete question',\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n\r\n  static updateAnswer(req, res) {\r\n    const { questionId, answerNumber } = req.params;\r\n    const currentUserId = req.user.userId;\r\n    const { answer } = req.body;\r\n    questionManager.getQuestionAndAnswer(questionId, (err, result) => {\r\n      const answerData = [];\r\n      let isAnswer = 'not found';\r\n      result.forEach((item) => {\r\n        if (item.answernumber === Number(answerNumber)) {\r\n          isAnswer = 'found';\r\n          return answerData.push(item);\r\n        }\r\n      });\r\n      if (isAnswer === 'found') {\r\n        if (currentUserId === Number(questionId)) {\r\n          questionManager.markAnswer(answerNumber, (result) => {\r\n            if (result === 'successfully marked') {\r\n              return res.status(200).json({\r\n                success: true,\r\n                message: 'Answer marked as approved!',\r\n              });\r\n            }\r\n            return res.status(500).json({\r\n              success: false,\r\n              message: 'unable to mark answer',\r\n            });\r\n          });\r\n        } else if (currentUserId === answerData[0].userid) {\r\n          questionManager.updateAnswer(answerNumber, answer, (error, answerInfo) => {\r\n            if (error) {\r\n              return res.status(500).json({\r\n                success: false,\r\n                message: 'Unable to update Answer',\r\n              });\r\n            }\r\n            return res.status(200).json({\r\n              success: true,\r\n              message: 'Your answer has been updated',\r\n              answerInfo,\r\n            });\r\n          });\r\n        }\r\n      } else {\r\n        return res.status(404).json({\r\n          success: false,\r\n          message: isAnswer,\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  static notFound(req, res) {\r\n    return res.status(404).json({\r\n      status: false,\r\n      message: 'Not Found!',\r\n    });\r\n  }\r\n}\r\n\r\nexport default QuestionRoute;\r\n"]}